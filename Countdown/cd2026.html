<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#05060a" />
  <title>è·¨å¹´å¤§å±æ—¶é’Ÿ</title>

  <style>
    /* è¯•ç€ç”¨ DIN ç³»åˆ—ï¼Œç³»ç»Ÿæ²¡æœ‰å°±è‡ªåŠ¨é™çº§ */
    :root{
      --din: "DIN", "DIN Alternate", "DIN Condensed", "DINPro", "DIN Pro", "Bahnschrift",
             ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
             "PingFang SC", "Hiragino Sans GB", "Noto Sans CJK SC", "Microsoft YaHei", Arial, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      /* base */
      --bg0:#05060a;
      --bg1:#0a0f2a;
      --fg:#eef2ff;
      --muted:rgba(238,242,255,.72);
      --glass:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --shadow: 0 20px 80px rgba(0,0,0,.45);
      --radius: 22px;

      /* accents */
      --accent:#7c3aed;
      --accent2:#22d3ee;
      --accent3:#a3ff12;

      --clockScale: 1;
      --glow: 0 0 26px rgba(124,58,237,.35), 0 0 60px rgba(34,211,238,.18);
    }

    /* ä¸»é¢˜ï¼ˆè‰²ç›˜ï¼‰ */
    [data-theme="aurora"]{ --bg0:#04050b; --bg1:#071b2a; --accent:#7c3aed; --accent2:#22d3ee; --accent3:#a3ff12;
      --glow: 0 0 30px rgba(34,211,238,.30), 0 0 70px rgba(124,58,237,.22); }
    [data-theme="neon"]{ --bg0:#05020a; --bg1:#120025; --accent:#ff4dd8; --accent2:#3bf0ff; --accent3:#ffe347;
      --glow: 0 0 34px rgba(255,77,216,.28), 0 0 90px rgba(59,240,255,.18); }
    [data-theme="amber"]{ --bg0:#090806; --bg1:#1a1307; --accent:#ffb020; --accent2:#ff6b6b; --accent3:#4ade80;
      --glow: 0 0 28px rgba(255,176,32,.22), 0 0 70px rgba(255,107,107,.14); }
    [data-theme="ice"]{ --bg0:#060b12; --bg1:#051a24; --accent:#60a5fa; --accent2:#22d3ee; --accent3:#f8fafc;
      --glow: 0 0 28px rgba(96,165,250,.22), 0 0 70px rgba(34,211,238,.14); }

    /* æ˜æš—æ¨¡å¼ï¼ˆå¤–è§‚ï¼‰ */
    [data-mode="dark"]{ /* é»˜è®¤å°±æ˜¯æš—ï¼Œè¿™é‡Œç•™ç©ºä¹Ÿè¡Œ */ }

    [data-mode="light"]{
      --bg0:#f6f7ff;
      --bg1:#e8ecff;
      --fg:#111827;
      --muted:rgba(17,24,39,.70);
      --glass:rgba(0,0,0,.04);
      --stroke:rgba(17,24,39,.12);
      --shadow: 0 18px 60px rgba(17,24,39,.18);
    }

    @media (prefers-color-scheme: light){
      [data-mode="auto"]{
        --bg0:#f6f7ff;
        --bg1:#e8ecff;
        --fg:#111827;
        --muted:rgba(17,24,39,.70);
        --glass:rgba(0,0,0,.04);
        --stroke:rgba(17,24,39,.12);
        --shadow: 0 18px 60px rgba(17,24,39,.18);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; overflow:hidden; font-family: var(--din)}
    body{
      background:
        radial-gradient(1200px 800px at 20% 20%, color-mix(in srgb, var(--accent) 24%, transparent), transparent 60%),
        radial-gradient(1100px 700px at 80% 30%, color-mix(in srgb, var(--accent2) 22%, transparent), transparent 60%),
        radial-gradient(900px 600px at 60% 85%, color-mix(in srgb, var(--accent3) 12%, transparent), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--fg);
      position:relative;
    }

    .bg-anim{
      position:absolute; inset:-40%;
      background:
        radial-gradient(closest-side at 25% 30%, color-mix(in srgb, var(--accent) 22%, transparent), transparent 65%),
        radial-gradient(closest-side at 75% 25%, color-mix(in srgb, var(--accent2) 18%, transparent), transparent 65%),
        radial-gradient(closest-side at 65% 80%, color-mix(in srgb, var(--accent3) 12%, transparent), transparent 68%);
      filter: blur(40px) saturate(1.15);
      animation: drift 18s ease-in-out infinite alternate;
      opacity:.9;
      pointer-events:none;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%{transform: translate3d(-2%, -1%, 0) scale(1.03) rotate(-1deg)}
      100%{transform: translate3d(2%, 1.5%, 0) scale(1.07) rotate(1deg)}
    }

    .wrap{ position:relative; height:100%; display:grid; place-items:center; padding: min(4vmin, 28px); }
    .panel{
      width:min(1180px, 96vw);
      border-radius: var(--radius);
      background: linear-gradient(180deg, color-mix(in srgb, var(--glass) 100%, transparent), color-mix(in srgb, var(--glass) 60%, transparent));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: min(4vmin, 34px);
      position:relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 120deg,
        transparent,
        color-mix(in srgb, var(--accent) 20%, transparent),
        color-mix(in srgb, var(--accent2) 16%, transparent),
        color-mix(in srgb, var(--accent3) 10%, transparent),
        transparent);
      filter: blur(18px);
      opacity:.55;
      pointer-events:none;
      animation: spin 18s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .content{
      position:relative;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: min(3.2vmin, 28px);
      align-items:center;
    }
    /* å¸ƒå±€ï¼šä¸Šä¸‹ */
    [data-layout="vertical"] .content{
      grid-template-columns: 1fr;
      align-items:stretch;
    }

    @media (max-width: 880px){
      .content{grid-template-columns: 1fr; gap: 18px}
    }

    .clockCard{
      position:relative;
      padding: min(3.2vmin, 26px);
      border-radius: 18px;
      border:1px solid color-mix(in srgb, var(--stroke) 88%, transparent);
      background: color-mix(in srgb, #000 18%, transparent);
      overflow:hidden;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .clockCard{ background: color-mix(in srgb, #fff 55%, transparent); }
    }
    [data-mode="light"] .clockCard{ background: color-mix(in srgb, #fff 55%, transparent); }

    .ring{
      position:absolute; inset:-2px; border-radius: 20px; pointer-events:none; opacity:.95;
      background:
        radial-gradient(closest-side, color-mix(in srgb, #000 28%, transparent), color-mix(in srgb, #000 55%, transparent)),
        conic-gradient(from -90deg,
          color-mix(in srgb, var(--accent2) 90%, transparent),
          color-mix(in srgb, var(--accent) 86%, transparent),
          color-mix(in srgb, var(--accent3) 55%, transparent),
          color-mix(in srgb, var(--accent) 22%, transparent));
      mask: radial-gradient(closest-side, transparent 68%, #000 69%);
      filter: blur(.2px);
      mix-blend-mode: screen;
    }
    .ringMask{
      position:absolute; inset:10px; border-radius: 14px;
      background: color-mix(in srgb, #000 35%, transparent);
      border:1px solid color-mix(in srgb, var(--stroke) 70%, transparent);
      pointer-events:none;
    }

    .topLine{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid color-mix(in srgb, var(--stroke) 80%, transparent);
      background: color-mix(in srgb, var(--glass) 70%, transparent);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: color-mix(in srgb, var(--muted) 88%, transparent);
      font-size: 13px;
      letter-spacing: .02em;
      user-select:none;
      white-space:nowrap;
    }
    .badge strong{ color: var(--fg); font-weight:800; }

    .timeRow{
      display:flex;
      align-items:baseline;
      gap: min(2.4vmin, 18px);
      flex-wrap:wrap;
      justify-content:center;
      text-align:center;
      transform: scale(var(--clockScale));
      transform-origin: center;
      filter: drop-shadow(var(--glow));
    }

    .time{
      font-family: var(--din);
      font-variant-numeric: tabular-nums;
      letter-spacing: .02em;
      font-size: clamp(64px, 11vw, 154px);
      line-height: 1;
      font-weight: 900;
      white-space:nowrap;
    }

    .colon{
      display:inline-block;
      width:.42em;
      text-align:center;
      opacity:.92;
      animation: blink 1s steps(1,end) infinite;
    }
    @keyframes blink{50%{opacity:.18}}

    .sec{
      font-family: var(--din);
      font-variant-numeric: tabular-nums;
      font-size: clamp(18px, 2.8vw, 30px);
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      color: var(--muted);
      backdrop-filter: blur(10px);
    }

    .date{
      margin-top: 18px;
      text-align:center;
      font-size: clamp(18px, 2.6vw, 28px);
      color: var(--muted);
      letter-spacing: .02em;
    }

    .sub{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      color: color-mix(in srgb, var(--muted) 92%, transparent);
      font-size: 13px;
    }
    .pill{
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      backdrop-filter: blur(10px);
    }
    .pill strong{color:var(--fg); font-weight:800}

    .side{ display:grid; gap: 14px; align-content:start; }
    .card{
      border-radius: 18px;
      border:1px solid color-mix(in srgb, var(--stroke) 82%, transparent);
      background: color-mix(in srgb, #000 18%, transparent);
      padding: 16px 16px;
      position:relative;
      overflow:hidden;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .card{ background: color-mix(in srgb, #fff 55%, transparent); }
    }
    [data-mode="light"] .card{ background: color-mix(in srgb, #fff 55%, transparent); }

    .card h3{
      margin:0 0 10px 0;
      font-size: 13px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: color-mix(in srgb, var(--muted) 88%, transparent);
      font-weight:800;
    }

    .countdown{ display:grid; gap: 10px; }
    .big{
      font-family: var(--din);
      font-variant-numeric: tabular-nums;
      font-size: clamp(22px, 3.4vw, 36px);
      font-weight: 900;
      letter-spacing: .02em;
    }
    .tiny{ color: color-mix(in srgb, var(--muted) 92%, transparent); font-size: 14px; line-height:1.5; }

    .bar{ height: 12px; border-radius: 999px; background: color-mix(in srgb, var(--glass) 95%, transparent);
      border:1px solid color-mix(in srgb, var(--stroke) 82%, transparent); overflow:hidden; }
    .bar > i{
      display:block; height:100%; width: 0%;
      background: linear-gradient(90deg,
        color-mix(in srgb, var(--accent) 90%, transparent),
        color-mix(in srgb, var(--accent2) 86%, transparent),
        color-mix(in srgb, var(--accent3) 55%, transparent));
      border-radius: 999px;
      box-shadow: 0 0 18px color-mix(in srgb, var(--accent2) 28%, transparent);
    }

    .miniGrid{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 880px){ .miniGrid{grid-template-columns:1fr} }
    .mini{
      border-radius: 14px;
      border:1px solid color-mix(in srgb, var(--stroke) 78%, transparent);
      background: color-mix(in srgb, var(--glass) 80%, transparent);
      padding: 12px 12px;
      position:relative;
      overflow:hidden;
    }
    .mini .tz{ font-size:12px; color: color-mix(in srgb, var(--muted) 94%, transparent); letter-spacing:.08em; }
    .mini .t{
      font-family: var(--din);
      font-variant-numeric: tabular-nums;
      font-size: 22px;
      font-weight:900;
      margin-top: 4px;
    }
    .mini .dayTag{
      position:absolute;
      right:10px;
      top:10px;
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border:1px solid color-mix(in srgb, var(--stroke) 82%, transparent);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      color: color-mix(in srgb, var(--muted) 92%, transparent);
      display:none;
      user-select:none;
    }
    .mini.nextday .dayTag{ display:inline-flex; }
    .mini.nextday::after{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(closest-side at 30% 30%, color-mix(in srgb, var(--accent2) 18%, transparent), transparent 60%),
        radial-gradient(closest-side at 70% 70%, color-mix(in srgb, var(--accent) 14%, transparent), transparent 60%);
      filter: blur(18px);
      opacity:.55;
      animation: shimmer 1.6s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes shimmer{
      0%{transform: translate3d(-2%, -1%, 0) rotate(-1deg)}
      100%{transform: translate3d(2%, 1.5%, 0) rotate(1deg)}
    }
    .mini.flash{
      animation: flash 0.9s ease;
    }
    @keyframes flash{
      0%{ box-shadow: 0 0 0 0 color-mix(in srgb, var(--accent2) 32%, transparent); }
      60%{ box-shadow: 0 0 0 10px transparent; }
      100%{ box-shadow: 0 0 0 0 transparent; }
    }

    .hint{ margin-top: 6px; font-size: 12px; color: color-mix(in srgb, var(--muted) 92%, transparent); }

    /* HUD / controls */
    .controls{
      position:fixed;
      right: 16px;
      bottom: 16px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      z-index: 30;
      transition: opacity .25s ease, transform .25s ease;
    }
    .btn{
      border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);
      background: color-mix(in srgb, #000 32%, transparent);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      cursor:pointer;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      user-select:none;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .btn{ background: color-mix(in srgb, #fff 60%, transparent); }
    }
    [data-mode="light"] .btn{ background: color-mix(in srgb, #fff 60%, transparent); }

    .btn:hover{background: color-mix(in srgb, var(--glass) 95%, transparent)}
    .btn:active{transform: translateY(1px)}
    .btn small{opacity:.7}
    .btn.on{
      border-color: color-mix(in srgb, var(--accent2) 40%, transparent);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent2) 14%, transparent) inset;
    }

    .hud{
      position:fixed;
      left:16px;
      bottom:16px;
      z-index: 30;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color: color-mix(in srgb, var(--muted) 92%, transparent);
      font-size: 12px;
      transition: opacity .25s ease, transform .25s ease;
    }
    .kbd{
      font-family: var(--mono);
      padding: 6px 8px;
      border-radius: 10px;
      border:1px solid color-mix(in srgb, var(--stroke) 82%, transparent);
      background: color-mix(in srgb, #000 25%, transparent);
      backdrop-filter: blur(10px);
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .kbd{ background: color-mix(in srgb, #fff 65%, transparent); }
    }
    [data-mode="light"] .kbd{ background: color-mix(in srgb, #fff 65%, transparent); }

    .toast{
      position:fixed;
      top: 18px;
      left:50%;
      transform: translateX(-50%);
      z-index: 60;
      padding: 12px 14px;
      border-radius: 999px;
      border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);
      background: color-mix(in srgb, #000 38%, transparent);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      color: color-mix(in srgb, var(--fg) 92%, transparent);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      box-shadow: var(--shadow);
      white-space:nowrap;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .toast{ background: color-mix(in srgb, #fff 70%, transparent); }
    }
    [data-mode="light"] .toast{ background: color-mix(in srgb, #fff 70%, transparent); }

    .toast.show{opacity:1; transform: translateX(-50%) translateY(0)}
    .toast.hide{opacity:0; transform: translateX(-50%) translateY(-6px)}

    /* celebration */
    .celebrate{
      position:fixed; inset:0;
      display:grid; place-items:center;
      z-index: 55;
      pointer-events:none;
      opacity:0;
      transition: opacity .35s ease;
    }
    .celebrate.show{opacity:1}
    .celebrate .msg{
      text-align:center;
      padding: 22px 26px;
      border-radius: 22px;
      border:1px solid color-mix(in srgb, var(--stroke) 90%, transparent);
      background: color-mix(in srgb, #000 35%, transparent);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      filter: drop-shadow(var(--glow));
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .celebrate .msg{ background: color-mix(in srgb, #fff 70%, transparent); }
    }
    [data-mode="light"] .celebrate .msg{ background: color-mix(in srgb, #fff 70%, transparent); }

    .celebrate .msg .h{
      font-size: clamp(34px, 6vw, 64px);
      font-weight: 950;
      letter-spacing: .02em;
      margin:0 0 10px 0;
    }
    .celebrate .msg .p{
      margin:0;
      font-size: clamp(14px, 2.4vw, 20px);
      color: color-mix(in srgb, var(--muted) 92%, transparent);
    }

    canvas#confetti{ position:fixed; inset:0; z-index: 50; pointer-events:none; opacity:0; transition: opacity .35s ease; }
    canvas#confetti.show{opacity:1}

    /* hide UI */
    .cursor-hide{cursor:none}
    .ui-hide .controls, .ui-hide .hud{opacity:0; transform: translateY(6px); pointer-events:none}

    /* Settings modal */
    .overlay{
      position:fixed; inset:0;
      background: color-mix(in srgb, #000 55%, transparent);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 80;
      display:none;
      padding: 18px;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .overlay{ background: color-mix(in srgb, #000 35%, transparent); }
    }
    [data-mode="light"] .overlay{ background: color-mix(in srgb, #000 35%, transparent); }

    .overlay.show{display:grid; place-items:center}
    .modal{
      width:min(720px, 94vw);
      border-radius: 20px;
      border:1px solid color-mix(in srgb, var(--stroke) 92%, transparent);
      background: color-mix(in srgb, #000 30%, transparent);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    @media (prefers-color-scheme: light){
      [data-mode="auto"] .modal{ background: color-mix(in srgb, #fff 78%, transparent); }
    }
    [data-mode="light"] .modal{ background: color-mix(in srgb, #fff 78%, transparent); }

    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 16px;
      border-bottom:1px solid color-mix(in srgb, var(--stroke) 80%, transparent);
    }
    .modalHead .title{
      font-weight: 900;
      letter-spacing: .02em;
    }
    .modalBody{
      padding: 14px 16px 16px 16px;
      display:grid;
      gap: 14px;
    }
    .row{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 12px;
      align-items:center;
    }
    @media (max-width: 560px){
      .row{grid-template-columns:1fr; gap:8px}
    }
    .label{
      color: color-mix(in srgb, var(--muted) 92%, transparent);
      font-weight: 800;
      letter-spacing: .02em;
      font-size: 13px;
    }
    .controlLine{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
    }
    select, input[type="range"]{
      accent-color: var(--accent2);
    }
    .sel, .input{
      border:1px solid color-mix(in srgb, var(--stroke) 82%, transparent);
      background: color-mix(in srgb, var(--glass) 90%, transparent);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 12px;
      outline:none;
      font-size: 13px;
    }
    .sel{ cursor:pointer; }
    .smallBtn{
      border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);
      background: color-mix(in srgb, var(--glass) 90%, transparent);
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
    }
    .smallBtn:hover{ background: color-mix(in srgb, var(--glass) 100%, transparent); }
    .smallBtn.on{
      border-color: color-mix(in srgb, var(--accent2) 40%, transparent);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent2) 14%, transparent) inset;
    }
    .note{
      font-size: 12px;
      color: color-mix(in srgb, var(--muted) 92%, transparent);
      line-height:1.6;
    }
  </style>
</head>

<body data-theme="aurora" data-mode="auto" data-layout="horizontal">
  <div class="bg-anim"></div>

  <canvas id="confetti"></canvas>

  <div class="celebrate" id="celebrate">
    <div class="msg">
      <p class="h" id="celebrateTitle">æ–°å¹´å¿«ä¹</p>
      <p class="p" id="celebrateSub">ä»Šæ™šå°±åˆ«è®²é“ç†äº†ï¼Œè®²ç—›å¿«</p>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Settings Modal -->
  <div class="overlay" id="settingsOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="è®¾ç½®">
      <div class="modalHead">
        <div class="title">è®¾ç½®</div>
        <button class="smallBtn" id="btnCloseSettings">å…³é—­</button>
      </div>
      <div class="modalBody">

        <div class="row">
          <div class="label">å¤–è§‚æ¨¡å¼</div>
          <div class="controlLine">
            <select class="sel" id="selMode" title="auto/dark/light">
              <option value="auto">è‡ªåŠ¨åŒ¹é…ç³»ç»Ÿ</option>
              <option value="dark">æ·±è‰²</option>
              <option value="light">æµ…è‰²</option>
            </select>
            <select class="sel" id="selTheme" title="è‰²ç›˜ä¸»é¢˜">
              <option value="aurora">aurora</option>
              <option value="neon">neon</option>
              <option value="amber">amber</option>
              <option value="ice">ice</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="label">å¸ƒå±€</div>
          <div class="controlLine">
            <button class="smallBtn" id="btnLayoutH">å·¦å³æ’ç‰ˆ</button>
            <button class="smallBtn" id="btnLayoutV">ä¸Šä¸‹æ’ç‰ˆ</button>
          </div>
        </div>

        <div class="row">
          <div class="label">æ˜¾ç¤º</div>
          <div class="controlLine">
            <button class="smallBtn" id="btnTogSeconds">æ˜¾ç¤ºç§’</button>
            <button class="smallBtn" id="btnTogCountdown">å€’è®¡æ—¶</button>
            <button class="smallBtn" id="btnTogWorld">ä¸–ç•Œæ—¶é’Ÿ</button>
          </div>
        </div>

        <div class="row">
          <div class="label">å­—å·</div>
          <div class="controlLine">
            <input type="range" id="rngScale" min="80" max="135" step="1" />
            <span class="note" id="txtScale">100%</span>
          </div>
        </div>

        <div class="row">
          <div class="label">è®¾å¤‡</div>
          <div class="controlLine">
            <button class="smallBtn" id="btnWakeLock">å±å¹•å¸¸äº®</button>
            <button class="smallBtn" id="btnFullscreen">å…¨å±</button>
            <button class="smallBtn" id="btnHideUI">éšè—UI</button>
          </div>
        </div>

        <div class="row">
          <div class="label">å£°éŸ³</div>
          <div class="controlLine">
            <button class="smallBtn" id="btnEnableSound">å¯ç”¨å£°éŸ³</button>
            <button class="smallBtn" id="btnMute">é™éŸ³</button>
          </div>
        </div>

        <div class="row">
          <div class="label">æµ‹è¯•</div>
          <div class="controlLine">
            <button class="smallBtn" id="btnTestNY">æ‰‹åŠ¨æµ‹è¯•è·¨å¹´æ•ˆæœ</button>
            <button class="smallBtn" id="btnStopFX">åœæ­¢ç‰¹æ•ˆ</button>
          </div>
        </div>

        <div class="note">
          å¿«æ·é”®ï¼šF å…¨å±ï¼ŒT æ¢è‰²ç›˜ä¸»é¢˜ï¼ŒS ç§’æ˜¾ç¤ºï¼ŒC å€’è®¡æ—¶ï¼ŒW å¸¸äº®ï¼ŒM é™éŸ³ï¼ŒSpace éšè—UIã€‚
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="content">
        <div class="clockCard">
          <div class="ring" id="dayRing"></div>
          <div class="ringMask"></div>

          <div class="topLine">
            <div class="badge">å¹´ä»½ <strong id="yearText">2026</strong></div>
            <div class="badge">ä»Šæ™šï¼š<strong id="greetText">è·¨å¹´æ¨¡å¼</strong></div>
          </div>

          <div class="timeRow" id="timeRow">
            <div class="time" id="timeText">00:00</div>
            <div class="sec" id="secText">00</div>
          </div>

          <div class="date" id="dateText">2026å¹´1æœˆ1æ—¥ æ˜ŸæœŸå››</div>

          <div class="sub">
            <div class="pill">æœ¬åœ°æ—¶é—´</div>
            <div class="pill" id="statusPill"><strong id="statusMini">åœ¨çº¿</strong></div>
          </div>
        </div>

        <div class="side">
          <div class="card" id="cardCountdown">
            <h3>å€’è®¡æ—¶</h3>
            <div class="countdown">
              <div class="big" id="countdownText">--</div>
              <div class="tiny" id="countdownSub">--</div>
              <div class="bar"><i id="countdownBar"></i></div>
            </div>
          </div>

          <div class="card" id="cardWorld">
            <h3>ä¸–ç•Œæ—¶é—´</h3>
            <div class="miniGrid" id="worldGrid"></div>
            <div class="hint">è·¨åˆ°ç¬¬äºŒå¤©ä¼šæœ‰ä¸€ç‚¹ç‚¹é—ªåŠ¨</div>
          </div>

          <div class="card" id="cardStatus">
            <h3>çŠ¶æ€</h3>
            <div class="tiny" id="statusText">--</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="hud" id="hud">
    <span class="kbd">F å…¨å±</span>
    <span class="kbd">T ä¸»é¢˜</span>
    <span class="kbd">S ç§’</span>
    <span class="kbd">C å€’è®¡æ—¶</span>
    <span class="kbd">W å¸¸äº®</span>
    <span class="kbd">M é™éŸ³</span>
    <span class="kbd">Space éšè—UI</span>
  </div>

  <div class="controls" id="controls">
    <button class="btn" id="btnOpenSettings">è®¾ç½®</button>
  </div>

  <script>
    (function(){
      const $ = (id)=>document.getElementById(id);

      const timeText = $("timeText");
      const secText = $("secText");
      const dateText = $("dateText");
      const yearText = $("yearText");
      const greetText = $("greetText");
      const statusMini = $("statusMini");

      const countdownText = $("countdownText");
      const countdownSub = $("countdownSub");
      const countdownBar = $("countdownBar");

      const toast = $("toast");
      const dayRing = $("dayRing");

      const worldGrid = $("worldGrid");
      const statusText = $("statusText");

      const celebrate = $("celebrate");
      const celebrateTitle = $("celebrateTitle");
      const celebrateSub = $("celebrateSub");

      const settingsOverlay = $("settingsOverlay");
      const btnOpenSettings = $("btnOpenSettings");
      const btnCloseSettings = $("btnCloseSettings");

      const selMode = $("selMode");
      const selTheme = $("selTheme");

      const btnLayoutH = $("btnLayoutH");
      const btnLayoutV = $("btnLayoutV");

      const btnTogSeconds = $("btnTogSeconds");
      const btnTogCountdown = $("btnTogCountdown");
      const btnTogWorld = $("btnTogWorld");

      const rngScale = $("rngScale");
      const txtScale = $("txtScale");

      const btnWakeLock = $("btnWakeLock");
      const btnFullscreen = $("btnFullscreen");
      const btnHideUI = $("btnHideUI");

      const btnEnableSound = $("btnEnableSound");
      const btnMute = $("btnMute");

      const btnTestNY = $("btnTestNY");
      const btnStopFX = $("btnStopFX");

      const cardCountdown = $("cardCountdown");
      const cardWorld = $("cardWorld");

      const THEMES = ["aurora","neon","amber","ice"];
      const WORLD_CLOCKS = [
        {label:"Beijing", tz:"Asia/Shanghai"},
        {label:"Tokyo", tz:"Asia/Tokyo"},
        {label:"London", tz:"Europe/London"},
        {label:"New York", tz:"America/New_York"}
      ];

      const store = {
        get(k, d){ try{ const v = localStorage.getItem(k); return v===null? d : JSON.parse(v);}catch(e){ return d; } },
        set(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} }
      };

      let showSeconds   = store.get("showSeconds", true);
      let showCountdown = store.get("showCountdown", true);
      let showWorld     = store.get("showWorld", true);

      let theme = store.get("theme", "aurora");
      if (!THEMES.includes(theme)) theme = "aurora";

      let mode = store.get("mode", "auto"); // auto/dark/light
      if (!["auto","dark","light"].includes(mode)) mode = "auto";

      let layout = store.get("layout", "horizontal"); // horizontal/vertical
      if (!["horizontal","vertical"].includes(layout)) layout = "horizontal";

      let muted = store.get("muted", false);
      let clockScale = store.get("clockScale", 1);

      document.body.dataset.theme = theme;
      document.body.dataset.mode = mode;
      document.body.dataset.layout = layout;
      document.documentElement.style.setProperty("--clockScale", String(clockScale));

      selMode.value = mode;
      selTheme.value = theme;

      // ---- toast
      let toastTimer = null;
      function showToast(msg){
        toast.textContent = msg;
        toast.classList.remove("hide");
        toast.classList.add("show");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(()=>{
          toast.classList.remove("show");
          toast.classList.add("hide");
        }, 1600);
      }

      // ---- fullscreen
      async function toggleFullscreen(){
        try{
          if (!document.fullscreenElement){
            await document.documentElement.requestFullscreen();
            showToast("å·²è¿›å…¥å…¨å±");
          } else {
            await document.exitFullscreen();
            showToast("å·²é€€å‡ºå…¨å±");
          }
        }catch(e){
          showToast("å…¨å±å¤±è´¥ï¼Œå¯èƒ½è¢«æµè§ˆå™¨é™åˆ¶");
        }
      }

      // ---- wake lock
      let wakeLock = null;
      async function toggleWakeLock(){
        if (!("wakeLock" in navigator)){
          showToast("æ­¤æµè§ˆå™¨ä¸æ”¯æŒå¸¸äº®");
          return;
        }
        try{
          if (wakeLock){
            await wakeLock.release();
            wakeLock = null;
            btnWakeLock.classList.remove("on");
            showToast("å·²å…³é—­å¸¸äº®");
          } else {
            wakeLock = await navigator.wakeLock.request("screen");
            btnWakeLock.classList.add("on");
            showToast("å·²å¼€å¯å¸¸äº®");
            wakeLock.addEventListener("release", ()=>{
              btnWakeLock.classList.remove("on");
              wakeLock = null;
            });
          }
        }catch(e){
          showToast("å¸¸äº®å¤±è´¥ï¼Œè¯•è¯•å…ˆç‚¹å…¨å±");
        }
      }

      // ---- audio
      let audioCtx = null;
      let soundArmed = store.get("soundArmed", false);

      function ensureAudio(){
        if (!audioCtx){
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
      }
      async function armSound(){
        try{
          ensureAudio();
          await audioCtx.resume();
          soundArmed = true;
          store.set("soundArmed", true);
          btnEnableSound.classList.add("on");
          showToast("å£°éŸ³å·²å¯ç”¨");
          chime();
        }catch(e){
          showToast("å£°éŸ³å¯ç”¨å¤±è´¥");
        }
      }
      function beep(freq=880, dur=0.08, vol=0.03){
        if (muted || !soundArmed) return;
        ensureAudio();
        if (audioCtx.state === "suspended") audioCtx.resume();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = "sine";
        o.frequency.value = freq;
        g.gain.value = vol;
        o.connect(g);
        g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + dur);
      }
      function chime(){
        beep(523.25, 0.14, 0.03);
        setTimeout(()=>beep(659.25, 0.14, 0.03), 120);
        setTimeout(()=>beep(783.99, 0.18, 0.03), 240);
      }

      // ---- confetti
      const canvas = $("confetti");
      const ctx = canvas.getContext("2d");
      let confetti = [];
      let confettiOn = false;

      function resizeCanvas(){
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        canvas.width = Math.floor(window.innerWidth * dpr);
        canvas.height = Math.floor(window.innerHeight * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function startConfetti(){
        confettiOn = true;
        canvas.classList.add("show");
        const W = window.innerWidth, H = window.innerHeight;
        confetti = [];
        const n = Math.floor(Math.min(340, Math.max(200, W*H/8500)));
        for (let i=0;i<n;i++){
          confetti.push({
            x: Math.random()*W,
            y: -Math.random()*H,
            vx: (Math.random()-0.5)*2.2,
            vy: 2.8 + Math.random()*4.5,
            r: 4 + Math.random()*6,
            a: Math.random()*Math.PI*2,
            va: (Math.random()-0.5)*0.25,
            c: i%3===0 ? "rgba(124,58,237,.85)" : (i%3===1 ? "rgba(34,211,238,.85)" : "rgba(163,255,18,.55)")
          });
        }
        requestAnimationFrame(tickConfetti);
      }
      function stopConfetti(){
        confettiOn = false;
        canvas.classList.remove("show");
      }
      function tickConfetti(){
        if (!confettiOn) return;
        const W = window.innerWidth, H = window.innerHeight;
        ctx.clearRect(0,0,W,H);
        for (const p of confetti){
          p.x += p.vx;
          p.y += p.vy;
          p.a += p.va;
          if (p.y > H + 40){ p.y = -20; p.x = Math.random()*W; }
          if (p.x < -40) p.x = W+40;
          if (p.x > W+40) p.x = -40;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.a);
          ctx.fillStyle = p.c;
          ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.7);
          ctx.restore();
        }
        requestAnimationFrame(tickConfetti);
      }

      // ---- helpers
      function pad2(n){ return String(n).padStart(2,"0"); }
      function weekdayCN(d){
        return ["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"][d.getDay()];
      }
      function formatDateCNFull(d){
        return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥  ${weekdayCN(d)}`;
      }
      function getNextNewYearTarget(now){
        return new Date(now.getFullYear()+1, 0, 1, 0, 0, 0, 0);
      }
      function getDayProgress(now){
        const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0,0,0,0).getTime();
        const end   = start + 24*60*60*1000;
        return (now.getTime() - start) / (end - start);
      }
      function getYearProgress(now){
        const start = new Date(now.getFullYear(), 0, 1, 0,0,0,0).getTime();
        const end   = new Date(now.getFullYear()+1, 0, 1, 0,0,0,0).getTime();
        return (now.getTime() - start) / (end - start);
      }
      function getGreeting(now){
        const h = now.getHours();
        if (h < 6) return "æ·±å¤œè¿˜é†’ç€";
        if (h < 11) return "ä¸Šåˆåœ¨çº¿";
        if (h < 14) return "ä¸­åˆåˆ«å¤ªå·";
        if (h < 18) return "ä¸‹åˆç»§ç»­";
        if (h < 22) return "ä»Šæ™šå¼€åœº";
        return "è·¨å¹´æ¨¡å¼";
      }

      // ---- UI state
      function applyState(){
        secText.style.display = showSeconds ? "inline-flex" : "none";

        btnTogSeconds.classList.toggle("on", showSeconds);
        btnTogCountdown.classList.toggle("on", showCountdown);
        btnTogWorld.classList.toggle("on", showWorld);

        cardCountdown.style.display = showCountdown ? "" : "none";
        cardWorld.style.display = showWorld ? "" : "none";

        document.body.dataset.theme = theme;
        document.body.dataset.mode = mode;
        document.body.dataset.layout = layout;

        btnLayoutH.classList.toggle("on", layout === "horizontal");
        btnLayoutV.classList.toggle("on", layout === "vertical");

        btnMute.classList.toggle("on", muted);
        btnEnableSound.classList.toggle("on", soundArmed);

        const pct = Math.round(clockScale*100);
        txtScale.textContent = pct + "%";
        rngScale.value = String(pct);

        store.set("showSeconds", showSeconds);
        store.set("showCountdown", showCountdown);
        store.set("showWorld", showWorld);
        store.set("theme", theme);
        store.set("mode", mode);
        store.set("layout", layout);
        store.set("muted", muted);
        store.set("clockScale", clockScale);
      }

      // ---- world clocks with day-change effect
      const lastWorldDate = new Map(); // tz -> yyyy-mm-dd
      function dateKeyInTZ(now, tz){
        const parts = new Intl.DateTimeFormat("en-CA", { timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit" }).formatToParts(now);
        const y = parts.find(p=>p.type==="year")?.value ?? "0000";
        const m = parts.find(p=>p.type==="month")?.value ?? "00";
        const d = parts.find(p=>p.type==="day")?.value ?? "00";
        return `${y}-${m}-${d}`;
      }
      function renderWorld(now, mainDateKey){
        worldGrid.innerHTML = "";
        const fmtTime = (tz)=>new Intl.DateTimeFormat("en-GB", {
          timeZone: tz, hour12: false, hour: "2-digit", minute:"2-digit", second:"2-digit"
        }).format(now);

        for (const w of WORLD_CLOCKS){
          const k = dateKeyInTZ(now, w.tz);
          const div = document.createElement("div");
          div.className = "mini";
          div.innerHTML = `
            <div class="tz">${w.label} Â· ${w.tz}</div>
            <div class="t">${fmtTime(w.tz)}</div>
            <div class="dayTag">${k > mainDateKey ? "å·²åˆ°æ˜å¤©" : (k < mainDateKey ? "è¿˜åœ¨æ˜¨å¤©" : "")}</div>
          `;

          const isDiff = (k !== mainDateKey);
          div.classList.toggle("nextday", isDiff);

          const prev = lastWorldDate.get(w.tz);
          if (prev && prev !== k){
            div.classList.add("flash");
            setTimeout(()=>div.classList.remove("flash"), 950);
          }
          lastWorldDate.set(w.tz, k);

          worldGrid.appendChild(div);
        }
      }

      // ---- status
      let lastTick = performance.now(), frames = 0, fps = 0;
      let batteryObj = null;
      async function initBattery(){
        try{ if ("getBattery" in navigator) batteryObj = await navigator.getBattery(); }catch(e){}
      }
      initBattery();

      function renderStatus(){
        const online = navigator.onLine ? "åœ¨çº¿" : "ç¦»çº¿";
        statusMini.textContent = online;

        let bat = "â€”", charging = "";
        if (batteryObj){
          bat = Math.round(batteryObj.level * 100) + "%";
          charging = batteryObj.charging ? " å……ç”µä¸­" : "";
        }
        const scale = Math.round(clockScale*100) + "%";
        statusText.textContent = `ç½‘ç»œï¼š${online} ï½œ ç”µé‡ï¼š${bat}${charging} ï½œ æ˜¾ç¤ºï¼š${scale} ï½œ åˆ·æ–°ï¼š${fps}fps`;
      }

      // ---- UI hide
      let uiHidden = store.get("uiHidden", false);
      function setUIHidden(v){
        uiHidden = v;
        store.set("uiHidden", uiHidden);
        document.body.classList.toggle("ui-hide", uiHidden);
        showToast(uiHidden ? "UIå·²éšè—" : "UIå·²æ˜¾ç¤º");
      }

      // ---- settings modal
      function openSettings(){
        settingsOverlay.classList.add("show");
        settingsOverlay.setAttribute("aria-hidden","false");
      }
      function closeSettings(){
        settingsOverlay.classList.remove("show");
        settingsOverlay.setAttribute("aria-hidden","true");
      }

      // ---- celebration
      let celebratedKey = null;
      let autoStopTimer = null;

      function startCelebrate(title, sub){
        celebrateTitle.textContent = title;
        celebrateSub.textContent = sub;
        celebrate.classList.add("show");
        startConfetti();
        chime();
        setTimeout(()=>beep(988, 0.10, 0.03), 380);
        setTimeout(()=>beep(1175, 0.14, 0.03), 580);

        clearTimeout(autoStopTimer);
        autoStopTimer = setTimeout(stopCelebrate, 12000);
      }
      function stopCelebrate(){
        celebrate.classList.remove("show");
        stopConfetti();
        clearTimeout(autoStopTimer);
      }

      // ---- update loop
      let lastSecond = -1;

      function update(){
        const now = new Date();

        const h = pad2(now.getHours());
        const m = pad2(now.getMinutes());
        const s = pad2(now.getSeconds());

        timeText.innerHTML = `${h}<span class="colon">:</span>${m}`;
        secText.textContent = s;

        yearText.textContent = String(now.getFullYear());
        dateText.textContent = formatDateCNFull(now);
        greetText.textContent = getGreeting(now);

        // day progress ring
        const dp = Math.max(0, Math.min(1, getDayProgress(now)));
        const deg = Math.round(dp * 360);
        dayRing.style.background =
          `radial-gradient(closest-side, color-mix(in srgb, #000 28%, transparent), color-mix(in srgb, #000 55%, transparent)),
           conic-gradient(from -90deg,
             color-mix(in srgb, var(--accent2) 92%, transparent) 0deg,
             color-mix(in srgb, var(--accent) 88%, transparent) ${deg}deg,
             color-mix(in srgb, var(--stroke) 28%, transparent) ${deg}deg,
             color-mix(in srgb, var(--stroke) 28%, transparent) 360deg)`;

        // countdown
        if (showCountdown){
          const target = getNextNewYearTarget(now);
          const diff = target.getTime() - now.getTime();
          const nextYear = target.getFullYear();

          if (diff > 0){
            const totalSec = Math.floor(diff/1000);
            const dd = Math.floor(totalSec / 86400);
            const hh = Math.floor((totalSec % 86400) / 3600);
            const mm = Math.floor((totalSec % 3600) / 60);
            const ss = totalSec % 60;

            const partDay = dd>0 ? `${dd}å¤© ` : "";
            countdownText.textContent = `è· ${nextYear} è¿˜æœ‰ ${partDay}${pad2(hh)}:${pad2(mm)}:${pad2(ss)}`;

            const dayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23,59,59,999);
            const leftToday = dayEnd.getTime() - now.getTime();
            const p = 1 - Math.max(0, Math.min(1, leftToday / (24*60*60*1000)));
            countdownBar.style.width = `${Math.round(p*100)}%`;

            countdownSub.textContent = `ä»Šå¤©è¿›åº¦ ${Math.round(p*100)}% ï½œ å¹´è¿›åº¦ ${Math.round(getYearProgress(now)*100)}%`;
          } else {
            countdownText.textContent = `æ¬¢è¿æ¥åˆ° ${now.getFullYear()} ğŸ‰`;
            countdownSub.textContent = "æ–°çš„ä¸€å¹´ï¼Œå…ˆæŠŠä»Šæ™šè¿‡çˆ½";
            countdownBar.style.width = "100%";
          }
        }

        // tick sound
        const sec = now.getSeconds();
        if (sec !== lastSecond){
          lastSecond = sec;
          if (sec === 0) beep(740, 0.05, 0.018);
          else if (sec % 10 === 0) beep(660, 0.04, 0.012);
        }

        // auto celebrate at real midnight (local)
        const isMidnight = (now.getMonth() === 0 && now.getDate() === 1 && now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() <= 2);
        const key = now.getFullYear() + "-NY";
        if (isMidnight && celebratedKey !== key){
          celebratedKey = key;
          startCelebrate(`${now.getFullYear()} æ–°å¹´å¿«ä¹`, "ä»Šæ™šå°±åˆ«è®²é“ç†äº†ï¼Œè®²ç—›å¿«");
        }

        // world clocks
        if (showWorld){
          const mainKey = `${now.getFullYear()}-${pad2(now.getMonth()+1)}-${pad2(now.getDate())}`;
          renderWorld(now, mainKey);
        }

        // fps
        frames++;
        const t = performance.now();
        if (t - lastTick >= 800){
          fps = Math.round(frames * 1000 / (t - lastTick));
          frames = 0;
          lastTick = t;
        }
        renderStatus();

        requestAnimationFrame(update);
      }

      // ---- idle cursor hide
      let idleTimer = null;
      function poke(){
        clearTimeout(idleTimer);
        document.body.classList.remove("cursor-hide");
        idleTimer = setTimeout(()=>{ document.body.classList.add("cursor-hide"); }, 2500);
      }
      window.addEventListener("mousemove", poke, {passive:true});
      window.addEventListener("touchstart", poke, {passive:true});
      poke();

      // ---- wire events
      btnOpenSettings.addEventListener("click", openSettings);
      btnCloseSettings.addEventListener("click", closeSettings);
      settingsOverlay.addEventListener("click", (e)=>{
        if (e.target === settingsOverlay) closeSettings();
      });

      selMode.addEventListener("change", ()=>{
        mode = selMode.value;
        applyState();
        showToast("å¤–è§‚ï¼š" + (mode==="auto"?"è‡ªåŠ¨":(mode==="dark"?"æ·±è‰²":"æµ…è‰²")));
      });
      selTheme.addEventListener("change", ()=>{
        theme = selTheme.value;
        applyState();
        showToast("ä¸»é¢˜ï¼š" + theme);
      });

      btnLayoutH.addEventListener("click", ()=>{
        layout = "horizontal";
        applyState();
        showToast("å¸ƒå±€ï¼šå·¦å³æ’ç‰ˆ");
      });
      btnLayoutV.addEventListener("click", ()=>{
        layout = "vertical";
        applyState();
        showToast("å¸ƒå±€ï¼šä¸Šä¸‹æ’ç‰ˆ");
      });

      btnTogSeconds.addEventListener("click", ()=>{
        showSeconds = !showSeconds;
        applyState();
        showToast(showSeconds ? "æ˜¾ç¤ºç§’" : "éšè—ç§’");
      });
      btnTogCountdown.addEventListener("click", ()=>{
        showCountdown = !showCountdown;
        applyState();
        showToast(showCountdown ? "æ˜¾ç¤ºå€’è®¡æ—¶" : "éšè—å€’è®¡æ—¶");
      });
      btnTogWorld.addEventListener("click", ()=>{
        showWorld = !showWorld;
        applyState();
        showToast(showWorld ? "æ˜¾ç¤ºä¸–ç•Œæ—¶é’Ÿ" : "éšè—ä¸–ç•Œæ—¶é’Ÿ");
      });

      rngScale.addEventListener("input", ()=>{
        const pct = Number(rngScale.value);
        clockScale = Math.round((pct/100)*100)/100;
        document.documentElement.style.setProperty("--clockScale", String(clockScale));
        applyState();
      });

      btnWakeLock.addEventListener("click", toggleWakeLock);
      btnFullscreen.addEventListener("click", toggleFullscreen);
      btnHideUI.addEventListener("click", ()=>setUIHidden(!uiHidden));

      btnEnableSound.addEventListener("click", armSound);

      btnMute.addEventListener("click", ()=>{
        muted = !muted;
        store.set("muted", muted);
        applyState();
        showToast(muted ? "å·²é™éŸ³" : "å·²å–æ¶ˆé™éŸ³");
      });

      btnTestNY.addEventListener("click", ()=>{
        const y = new Date().getFullYear() + 1;
        startCelebrate(`${y} æ–°å¹´å¿«ä¹`, "è¿™åªæ˜¯æµ‹è¯•ï¼ŒçœŸæ­£çš„é›¶ç‚¹æ›´çˆ½");
        showToast("å·²è§¦å‘æµ‹è¯•è·¨å¹´ç‰¹æ•ˆ");
      });

      btnStopFX.addEventListener("click", ()=>{
        stopCelebrate();
        showToast("å·²åœæ­¢ç‰¹æ•ˆ");
      });

      // keyboard shortcuts
      window.addEventListener("keydown", (e)=>{
        const k = e.key.toLowerCase();
        if (k === "f"){ e.preventDefault(); toggleFullscreen(); }
        else if (k === "t"){
          e.preventDefault();
          const idx = THEMES.indexOf(theme);
          theme = THEMES[(idx+1+THEMES.length)%THEMES.length];
          selTheme.value = theme;
          applyState();
          showToast("ä¸»é¢˜ï¼š" + theme);
        }
        else if (k === "s"){ e.preventDefault(); showSeconds=!showSeconds; applyState(); showToast(showSeconds?"æ˜¾ç¤ºç§’":"éšè—ç§’"); }
        else if (k === "c"){ e.preventDefault(); showCountdown=!showCountdown; applyState(); showToast(showCountdown?"æ˜¾ç¤ºå€’è®¡æ—¶":"éšè—å€’è®¡æ—¶"); }
        else if (k === "w"){ e.preventDefault(); toggleWakeLock(); }
        else if (k === "m"){ e.preventDefault(); muted=!muted; applyState(); showToast(muted?"å·²é™éŸ³":"å·²å–æ¶ˆé™éŸ³"); }
        else if (k === " "){ e.preventDefault(); setUIHidden(!uiHidden); }
        else if (k === "escape"){
          if (settingsOverlay.classList.contains("show")) closeSettings();
        }
      });

      // initial
      applyState();
      setUIHidden(uiHidden);
      if (soundArmed) btnEnableSound.classList.add("on");

      showToast("å¤§å±æ—¶é’Ÿå·²å¯åŠ¨");
      requestAnimationFrame(update);
    })();
  </script>
</body>
</html>
