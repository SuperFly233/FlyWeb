<!DOCTYPE html>
<html>
<head>
    <title>双控贪吃蛇</title>
    <style>
        :root {
            --snake-head: #e74c3c;
            --snake-body: #c0392b;
            --food-color: #2ecc71;
            --bomb-color: #8e44ad;
            --bg-color: #2c3e50;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: var(--bg-color);
            font-family: 'Arial Rounded MT Bold', Arial;
            touch-action: none;
        }

        .game-container {
            position: relative;
            padding: 20px;
            background: #34495e;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        #gameCanvas {
            border: 3px solid #ecf0f1;
            border-radius: 8px;
            background: var(--bg-color);
        }

        /* 新增触摸控制区域 */
        .touch-controls {
            position: absolute;
            bottom: -120px;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        /* 优化后的统计面板 */
        .dashboard {
            position: absolute;
            left: -200px;
            top: 50%;
            transform: translateY(-50%);
            width: 180px;
            padding: 20px;
            background: #34495e;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            color: #ecf0f1;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 14px;
        }

        #highestScore {
            color: #f1c40f;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="dashboard">
            <div class="stat-item">
                <span>最高分：</span>
                <span id="highestScore">0</span>
            </div>
            <div class="stat-item">
                <span>长度：</span>
                <span id="snakeLength">1</span>
            </div>
            <div class="stat-item">
                <span>食物：</span>
                <span id="foodCount">0</span>
            </div>
            <div class="stat-item">
                <span>炸弹：</span>
                <span id="bombCount">0</span>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div class="touch-controls"></div>
    </div>

    <script>
        // 新增本地存储记录
        let highestScore = localStorage.getItem('snakeHighestScore') || 0;
        
        const Game = {
            gridSize: 20,
            colors: {
                snakeHead: 'var(--snake-head)',
                snakeBody: 'var(--snake-body)',
                food: 'var(--food-color)',
                bomb: 'var(--bomb-color)'
            },
            bombSpawnRate: 0.3,
            touchStartX: 0,
            touchStartY: 0
        };

        // 游戏初始化
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let snake = [], direction = 'right', score = 0;
        let foodCount = 0, bombCount = 0;
        let food, bomb, isPaused = false;

        function init() {
            const size = Math.min(window.innerWidth - 300, 500);
            canvas.width = canvas.height = size;
            snake = [{x: size/2, y: size/2}];
            food = spawnFood();
            bomb = Math.random() < Game.bombSpawnRate ? spawnBomb() : null;
            score = 0;
            updateStats();
            document.getElementById('highestScore').textContent = highestScore;
        }

        // 新增暂停功能
        function togglePause() {
            isPaused = !isPaused;
            if(!isPaused) gameLoop();
        }

        // 优化后的键盘控制（支持WASD和方向键）
        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': 'up', 'KeyW': 'up',
                'ArrowDown': 'down', 'KeyS': 'down',
                'ArrowLeft': 'left', 'KeyA': 'left',
                'ArrowRight': 'right', 'KeyD': 'right',
                'Space': () => togglePause()
            };
            
            if(keyMap[e.code]) {
                if(typeof keyMap[e.code] === 'function') {
                    keyMap[e.code]();
                } else if(direction !== oppositeDir(keyMap[e.code])) {
                    direction = keyMap[e.code];
                }
                e.preventDefault();
            }
        });

        // 新增触摸控制
        canvas.addEventListener('touchstart', (e) => {
            Game.touchStartX = e.touches[0].clientX;
            Game.touchStartY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const dx = e.touches[0].clientX - Game.touchStartX;
            const dy = e.touches[0].clientY - Game.touchStartY;
            
            if(Math.abs(dx) > Math.abs(dy)) {
                direction = dx > 0 && direction !== 'left' ? 'right' : 'left';
            } else {
                direction = dy > 0 && direction !== 'up' ? 'down' : 'up';
            }
        });

        // 其他优化函数（spawnFood、drawSnake等保持类似结构，略）

        // 新增最高分记录
        function updateHighestScore() {
            if(score > highestScore) {
                highestScore = score;
                localStorage.setItem('snakeHighestScore', highestScore);
            }
        }

        // 游戏主循环
        function gameLoop() {
            if(isPaused) return;
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        init();
        gameLoop();
    </script>
</body>
</html>
